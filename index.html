<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PreMed Learning Science Lab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --card: #111827;
      --ink: #f9fafb;
      --muted: #9ca3af;
      --accent: #10b981;
      --danger: #f97373;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827, #020617 55%);
      color: var(--ink);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header, footer {
      padding: 0.75rem 1rem;
      background: rgba(15,23,42,0.9);
      border-bottom: 1px solid #1f2937;
    }
    footer {
      border-top: 1px solid #1f2937;
      border-bottom: none;
      margin-top: auto;
      font-size: 0.85rem;
      color: var(--muted);
    }
    header-inner, main-inner {
      max-width: 960px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    main {
      flex: 1;
      padding: 1rem;
      display: flex;
      justify-content: center;
    }
    .view {
      display: none;
      max-width: 960px;
      width: 100%;
      margin: 0 auto;
    }
    .view.active {
      display: block;
    }
    h1, h2, h3 {
      font-weight: 600;
      letter-spacing: 0.02em;
    }
    h1 { font-size: 1.5rem; margin: 0; }
    h2 { font-size: 1.3rem; margin-top: 0; }
    p { line-height: 1.5; }

    .progress-shell {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      max-width: 360px;
      margin-left: 1rem;
    }
    .progress-track {
      flex: 1;
      height: 8px;
      border-radius: 999px;
      background: #111827;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg,#22c55e,#0ea5e9);
      transition: width 0.3s ease;
    }
    .progress-label {
      font-size: 0.85rem;
      color: var(--muted);
      white-space: nowrap;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      background: var(--accent);
      color: #022c22;
      font-weight: 500;
      box-shadow: 0 0 0 1px rgba(15,23,42,0.6), 0 8px 18px rgba(15,118,110,0.45);
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
    }
    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(15,118,110,0.6);
    }
    .btn.secondary {
      background: #1f2937;
      color: var(--ink);
      box-shadow: 0 0 0 1px #374151;
    }
    .btn.danger {
      background: var(--danger);
      color: #111827;
      box-shadow: 0 0 0 1px #7f1d1d;
    }
    .btn:disabled {
      opacity: 0.4;
      cursor: default;
      transform: none;
      box-shadow: 0 0 0 1px rgba(15,23,42,0.5);
    }

    .card {
      background: radial-gradient(circle at top left, #111827, #020617);
      border-radius: 1rem;
      border: 1px solid rgba(148,163,184,0.2);
      box-shadow: 0 18px 40px rgba(15,23,42,0.9);
      padding: 1.25rem 1.35rem;
    }
    .card + .card {
      margin-top: 1rem;
    }

    .stack {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      font-size: 0.75rem;
      background: rgba(15,118,110,0.15);
      color: #6ee7b7;
    }
    .chip.completed {
      background: rgba(34,197,94,0.15);
      color: #bbf7d0;
    }

    textarea, input, select {
      width: 100%;
      border-radius: 0.6rem;
      border: 1px solid #374151;
      padding: 0.6rem 0.7rem;
      background: #020617;
      color: var(--ink);
      font-size: 0.9rem;
      resize: vertical;
    }
    textarea {
      min-height: 140px;
    }
    label {
      display: block;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      margin-bottom: 0.25rem;
    }
    .field {
      margin-bottom: 1rem;
    }
    .meta {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .pill-nav {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    .hidden { display: none !important; }

    @media (max-width: 640px) {
      header-inner, main-inner {
        flex-direction: column;
        align-items: flex-start;
      }
      .progress-shell {
        margin-left: 0;
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner" style="max-width:960px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:1rem;">
      <div style="display:flex;align-items:center;gap:0.75rem;">
        <div style="width:32px;height:32px;border-radius:999px;border:1px solid #22c55e;display:flex;align-items:center;justify-content:center;font-size:0.8rem;color:#a5b4fc;">
          Δ
        </div>
        <div>
          <h1>PreMed Learning Science Lab</h1>
          <div class="meta">Ten mini-experiments to rewire how you study.</div>
        </div>
      </div>
      <div class="progress-shell" aria-label="Overall progress">
        <div class="progress-track" aria-hidden="true">
          <div class="progress-bar" id="globalProgressBar"></div>
        </div>
        <div class="progress-label" id="globalProgressLabel">0% complete</div>
      </div>
      <div style="display:flex;gap:0.5rem;">
        <button class="btn secondary" id="exportBtn" type="button">Export</button>
        <button class="btn danger" id="resetBtn" type="button">Reset</button>
      </div>
    </div>
  </header>

  <main>
    <div class="view active" id="view-landing" aria-labelledby="landingTitle">
      <div class="card stack">
        <div>
          <h2 id="landingTitle">Why your study habits feel busy but not effective</h2>
          <p>
            You are putting in the hours—highlighting, rereading, rewriting. The pages look neat, the
            effort feels real, and it seems like the right thing to do. But then the exam asks you to
            recall concepts from scratch, and the results do not match the time you invested. [file:12]
          </p>
          <p>
            This lab turns you into a scientist of your own learning. In ten short experiments, you will
            contrast your current habits with evidence from cognitive science, make predictions, and run
            small trials in your actual courses. [file:12]
          </p>
        </div>
        <div style="display:flex;gap:0.75rem;flex-wrap:wrap;align-items:center;">
          <button class="btn" type="button" data-nav="dashboard">Begin your study transformation</button>
          <button class="btn secondary" type="button" data-nav="roadmap">Peek at the roadmap</button>
        </div>
      </div>
    </div>

    <div class="view" id="view-dashboard" aria-labelledby="dashboardTitle">
      <div class="card stack">
        <div>
          <h2 id="dashboardTitle">Your experiment deck</h2>
          <p class="meta">
            Complete experiments in any order. Each one takes about 10–15 minutes and ends with a
            concrete change you can test in a real course. [file:12]
          </p>
        </div>
        <div class="dashboard-grid">
          <!-- Skeleton: only Active Recall Arena card wired up for now -->
          <article class="card" data-experiment-card="activerecallarena">
            <h3>Active Recall Arena</h3>
            <p class="meta">
              Retrieval vs rereading: why recognizing material in your notes is not the same as being able
              to produce it on an exam. [file:12]
            </p>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:0.75rem;">
              <span class="chip" id="chip-activerecallarena">Not started</span>
              <button class="btn secondary" type="button" data-open-experiment="activerecallarena">
                Open
              </button>
            </div>
          </article>

          <!-- Placeholder cards for future experiments -->
          <article class="card">
            <h3>Spacing vs Cramming</h3>
            <p class="meta">Stub card for future experiment implementation.</p>
          </article>
          <article class="card">
            <h3>Interleaving Gauntlet</h3>
            <p class="meta">Stub card for future experiment implementation.</p>
          </article>
        </div>
      </div>
    </div>

    <div class="view" id="view-experiment" aria-labelledby="experimentTitle">
      <div class="pill-nav">
        <button class="btn secondary" type="button" data-nav="dashboard">&larr; Back to dashboard</button>
      </div>
      <div class="card stack">
        <header>
          <h2 id="experimentTitle">Active Recall Arena</h2>
          <p class="meta">
            Retrieval practice vs rereading. In this experiment, you will compare your instincts about
            studying to data from controlled experiments. [file:12]
          </p>
        </header>

        <!-- Phase 1: Observation and personal reflection -->
        <section aria-labelledby="phase1Title">
          <h3 id="phase1Title">Phase 1 — Recognition vs recall</h3>
          <div class="card" style="background:rgba(15,23,42,0.9);border-color:#334155;">
            <p style="font-style:italic;">
              “My go-to study method is to read my notes and the textbook over and over. It feels
              comfortable, and I start to recognize the material. But when the exam asks me to write
              answers from scratch, I freeze. My Cs tell me recognition is not enough.” [file:12]
            </p>
          </div>
          <div class="field">
            <label for="reflectionText">Pause for personal reflection</label>
            <p class="meta">
              Think about your last major exam. How did you prepare? How did it feel in the moment?
              What actually happened on the test? Try to write at least 100 words. [file:12]
            </p>
            <textarea id="reflectionText" placeholder="Type your honest reflection here..."></textarea>
            <div class="meta" id="reflectionMeta">0 / 100 words</div>
          </div>
          <button class="btn" type="button" id="reflectionContinueBtn" disabled>
            I have reflected — continue
          </button>
        </section>

        <!-- Phase 2–3: Curiosity, research question, hypothesis, prediction -->
        <section id="phase2plus" class="hidden" aria-labelledby="phase2Title">
          <h3 id="phase2Title">Phase 2 — Curiosity and research question</h3>
          <p>
            Curiosity question: <strong>What would happen if I tested myself on the material instead of
            just rereading it?</strong> [file:12]
          </p>
          <p>
            Research question: <strong>Does retrieval practice self‑testing produce better long‑term
            retention than repeated rereading when studying course material?</strong> [file:12]
          </p>

          <h3>Phase 3 — Your prediction</h3>
          <p>
            Hypothesis (research version): Retrieval practice (independent variable) leads to higher
            delayed test performance (dependent variable) than repeated rereading when study time and
            materials are held constant (control variables). [file:12]
          </p>
          <div class="field">
            <label for="predictionChoice">Which strategy do you predict will win on a delayed test?</label>
            <select id="predictionChoice">
              <option value="">Select your prediction…</option>
              <option value="rereading">Repeated rereading will do better</option>
              <option value="retrieval">Retrieval practice will do better</option>
              <option value="same">They will be about the same</option>
            </select>
          </div>
          <div class="field">
            <label for="predictionConfidence">How confident are you in this prediction? (1–5)</label>
            <input id="predictionConfidence" type="number" min="1" max="5" />
          </div>
          <button class="btn" type="button" id="predictionContinueBtn" disabled>
            Lock in my prediction
          </button>
        </section>

        <!-- Placeholder for later phases (design, results, personal experiment, etc.) -->
        <section id="phasePlaceholder" class="hidden">
          <h3>Next phases coming soon</h3>
          <p class="meta">
            This skeleton focuses on navigation, Phase 1–3, and state persistence. Additional phases
            (experimental design, results, personal experiment planner, deep‑dive article link, and
            completion toggle) can plug into the same pattern. [file:12]
          </p>
        </section>
      </div>
    </div>

    <div class="view" id="view-roadmap" aria-labelledby="roadmapTitle">
      <div class="card stack">
        <h2 id="roadmapTitle">Your future study roadmap</h2>
        <p>
          After you complete all ten experiments, this space will help you design a weekly schedule built
          around your peak time of day, evidence-based 50‑minute sessions, and a 1‑3‑7‑14‑30 spacing
          rhythm. [file:12]
        </p>
        <p class="meta">
          For now, this is a placeholder so you can wire up navigation and localStorage. The final version
          will read from your experiment data to generate recommendations. [file:12]
        </p>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-inner" style="max-width:960px;margin:0 auto;">
      Your inputs are stored only in your browser via localStorage. No accounts, no tracking, no data is
      sent to a server. [file:12]
    </div>
  </footer>

  <script>
    // ---------- STATE & LOCALSTORAGE ----------

    const STORAGE_KEY = "premedStudyLab";

    const defaultState = {
      experiments: {
        activerecallarena: {
          id: "activerecallarena",
          completed: false,
          personalReflection: "",
          reflectionWordCount: 0,
          predictionChoice: "",
          predictionConfidence: "",
          completedDate: null
        }
        // future experiments: spacing, interleaving, etc.
      },
      roadmap: {
        peakTime: "",
        scheduleTemplate: "",
        lastGenerated: null
      },
      lastViewedExperimentId: null,
      progressPercentage: 0
    };

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return structuredClone(defaultState);
        const parsed = JSON.parse(raw);
        return { ...structuredClone(defaultState), ...parsed };
      } catch (e) {
        console.warn("Failed to parse stored state, resetting.", e);
        return structuredClone(defaultState);
      }
    }

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      updateGlobalProgressUI();
      updateExperimentChips();
    }

    let state = loadState();

    // ---------- VIEW NAVIGATION ----------

    const views = {
      landing: document.getElementById("view-landing"),
      dashboard: document.getElementById("view-dashboard"),
      experiment: document.getElementById("view-experiment"),
      roadmap: document.getElementById("view-roadmap")
    };

    function showView(name) {
      Object.entries(views).forEach(([key, el]) => {
        if (key === name) {
          el.classList.add("active");
        } else {
          el.classList.remove("active");
        }
      });
      if (name === "experiment" && state.lastViewedExperimentId === "activerecallarena") {
        hydrateExperimentUI();
      }
    }

    document.querySelectorAll("[data-nav]").forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.getAttribute("data-nav");
        showView(target);
      });
    });

    // Dashboard card navigation for Active Recall Arena
    document.querySelectorAll("[data-open-experiment]").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-open-experiment");
        state.lastViewedExperimentId = id;
        saveState();
        showView("experiment");
      });
    });

    // ---------- PROGRESS UI ----------

    const progressBar = document.getElementById("globalProgressBar");
    const progressLabel = document.getElementById("globalProgressLabel");

    function recomputeProgress() {
      const experiments = Object.values(state.experiments);
      if (!experiments.length) return 0;
      const completed = experiments.filter(e => e.completed).length;
      return Math.round((completed / experiments.length) * 100);
    }

    function updateGlobalProgressUI() {
      state.progressPercentage = recomputeProgress();
      const pct = state.progressPercentage || 0;
      progressBar.style.width = pct + "%";
      progressLabel.textContent = pct + "% complete";
    }

    function updateExperimentChips() {
      const exp = state.experiments.activerecallarena;
      const chip = document.getElementById("chip-activerecallarena");
      if (!chip || !exp) return;
      if (exp.completed) {
        chip.textContent = "Completed";
        chip.classList.add("completed");
      } else if (exp.personalReflection || exp.predictionChoice) {
        chip.textContent = "In progress";
        chip.classList.remove("completed");
      } else {
        chip.textContent = "Not started";
        chip.classList.remove("completed");
      }
    }

    // ---------- EXPERIMENT: ACTIVE RECALL ARENA ----------

    const reflectionTextEl = document.getElementById("reflectionText");
    const reflectionMetaEl = document.getElementById("reflectionMeta");
    const reflectionContinueBtn = document.getElementById("reflectionContinueBtn");
    const phase2plusEl = document.getElementById("phase2plus");
    const predictionChoiceEl = document.getElementById("predictionChoice");
    const predictionConfidenceEl = document.getElementById("predictionConfidence");
    const predictionContinueBtn = document.getElementById("predictionContinueBtn");
    const phasePlaceholderEl = document.getElementById("phasePlaceholder");

    function countWords(str) {
      return (str.trim().match(/\S+/g) || []).length;
    }

    function hydrateExperimentUI() {
      const exp = state.experiments.activerecallarena;
      if (!exp) return;

      // Reflection
      reflectionTextEl.value = exp.personalReflection || "";
      reflectionMetaEl.textContent = (exp.reflectionWordCount || 0) + " / 100 words";
      if ((exp.reflectionWordCount || 0) >= 100) {
        reflectionContinueBtn.disabled = false;
        phase2plusEl.classList.remove("hidden");
      } else {
        reflectionContinueBtn.disabled = true;
        phase2plusEl.classList.add("hidden");
      }

      // Prediction
      predictionChoiceEl.value = exp.predictionChoice || "";
      predictionConfidenceEl.value = exp.predictionConfidence || "";
      if (exp.predictionChoice && exp.predictionConfidence) {
        predictionContinueBtn.disabled = false;
        phasePlaceholderEl.classList.remove("hidden");
      } else {
        predictionContinueBtn.disabled = true;
        phasePlaceholderEl.classList.add("hidden");
      }
    }

    reflectionTextEl.addEventListener("input", () => {
      const text = reflectionTextEl.value;
      const words = countWords(text);
      reflectionMetaEl.textContent = words + " / 100 words";
      const exp = state.experiments.activerecallarena;
      exp.personalReflection = text;
      exp.reflectionWordCount = words;
      if (words >= 100) {
        reflectionContinueBtn.disabled = false;
      } else {
        reflectionContinueBtn.disabled = true;
      }
      saveState();
    });

    reflectionContinueBtn.addEventListener("click", () => {
      phase2plusEl.classList.remove("hidden");
      // Simple focus move
      phase2plusEl.querySelector("h3")?.focus?.();
    });

    function validatePredictionInputs() {
      const choice = predictionChoiceEl.value;
      const conf = predictionConfidenceEl.value;
      const confNum = Number(conf);
      const ok = choice && conf && confNum >= 1 && confNum <= 5;
      predictionContinueBtn.disabled = !ok;
      return ok;
    }

    predictionChoiceEl.addEventListener("change", () => {
      const exp = state.experiments.activerecallarena;
      exp.predictionChoice = predictionChoiceEl.value;
      saveState();
      validatePredictionInputs();
    });

    predictionConfidenceEl.addEventListener("input", () => {
      const exp = state.experiments.activerecallarena;
      exp.predictionConfidence = predictionConfidenceEl.value;
      saveState();
      validatePredictionInputs();
    });

    predictionContinueBtn.addEventListener("click", () => {
      phasePlaceholderEl.classList.remove("hidden");
      // For now we do not mark the experiment complete; that will happen after later phases.
    });

    // ---------- EXPORT & RESET ----------

    document.getElementById("resetBtn").addEventListener("click", () => {
      const ok = confirm("This will clear all your saved reflections and progress on this device. Continue?");
      if (!ok) return;
      localStorage.removeItem(STORAGE_KEY);
      state = loadState();
      updateGlobalProgressUI();
      updateExperimentChips();
      hydrateExperimentUI();
      showView("landing");
    });

    document.getElementById("exportBtn").addEventListener("click", () => {
      const exp = state.experiments.activerecallarena;
      let text = "PreMed Learning Science Lab — Reflections Export\n\n";
      text += "Active Recall Arena\n";
      text += "--------------------\n";
      text += "Personal reflection:\n" + (exp.personalReflection || "[none]") + "\n\n";
      text += "Prediction choice: " + (exp.predictionChoice || "[none]") + "\n";
      text += "Prediction confidence (1–5): " + (exp.predictionConfidence || "[none]") + "\n";
      const blob = new Blob([text], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "premed-study-lab-reflections.txt";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // ---------- INITIALIZE ----------

    updateGlobalProgressUI();
    updateExperimentChips();
    if (state.lastViewedExperimentId === "activerecallarena") {
      hydrateExperimentUI();
    }
  </script>
</body>
</html>
